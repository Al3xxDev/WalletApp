<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Wallet</title>

    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#09090b" />
    <link rel="apple-touch-icon" href="icon.png" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="style.css" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div class="app-header">
      <div class="header-content">
        <h1 data-i18n="appTitle">My Wallet</h1>
        <button class="lang-btn" id="langBtn" onclick="toggleLanguage()">
          üáÆüáπ IT
        </button>
      </div>
    </div>

    <div class="container">
      <div
        class="section-label first-section animate-in delay-1"
        data-i18n="secOverview"
      >
        Panoramica
      </div>

      <div class="balance-card animate-in delay-1">
        <div class="balance-label" data-i18n="balanceLabel">Saldo Totale</div>
        <div class="balance-amount" id="balance">‚Ç¨0.00</div>
        <div class="stats-grid">
          <div class="stat-box">
            <div
              class="balance-label"
              data-i18n="incomeLabel"
              style="font-size: 10px"
            >
              Entrate
            </div>
            <div class="stat-val" style="color: #86efac">
              <span id="income">0.00</span>
            </div>
          </div>
          <div class="stat-box">
            <div
              class="balance-label"
              data-i18n="expenseLabel"
              style="font-size: 10px"
            >
              Uscite
            </div>
            <div class="stat-val" style="color: #fca5a5">
              <span id="expense">0.00</span>
            </div>
          </div>
        </div>
      </div>

      <div class="goal-card animate-in delay-2">
        <div class="goal-header">
          <div class="goal-title">
            üéØ
            <span id="goal-name-display" data-i18n="goalTitle">Obiettivo</span>
          </div>
          <button class="edit-goal-btn" onclick="toggleGoalEdit()">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
              ></path>
              <path
                d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
              ></path>
            </svg>
          </button>
        </div>

        <div class="progress-track">
          <div class="progress-fill" id="goal-bar"></div>
        </div>

        <div class="goal-stats">
          <span
            ><span id="goal-current">0</span> /
            <span id="goal-target-display">0</span></span
          >
          <span class="goal-percent" id="goal-percent">0%</span>
        </div>

        <div class="goal-edit-form" id="goal-edit-form">
          <div class="input-row">
            <div class="input-group">
              <label data-i18n="goalNameLabel">Nome Obiettivo</label>
              <input
                type="text"
                id="goal-name-input"
                placeholder="Es. Moto Nuova"
              />
            </div>
          </div>
          <div class="input-row">
            <div class="input-group">
              <label data-i18n="goalTargetLabel">Cifra da raggiungere</label>
              <input type="number" id="goal-target-input" placeholder="2000" />
            </div>
          </div>
          <button class="btn-main" onclick="saveGoal()" data-i18n="btnSaveGoal">
            Salva Obiettivo
          </button>
        </div>
      </div>

      <div
        id="chart-section-wrapper"
        style="display: none"
        class="animate-in delay-3"
      >
        <div class="section-label" data-i18n="secStats">Statistiche</div>
        <div class="chart-container">
          <div class="chart-wrapper">
            <canvas id="expenseChart"></canvas>
          </div>
        </div>
      </div>

      <div class="section-label animate-in delay-3" data-i18n="secNew">
        Nuovo Movimento
      </div>

      <div class="form-section animate-in delay-3" id="form-card">
        <div class="input-row">
          <div class="input-group">
            <label data-i18n="dateLabel">Data</label>
            <input type="date" id="date" />
          </div>
        </div>
        <div class="input-row">
          <div class="input-group">
            <label data-i18n="catLabel">Categoria</label>
            <select id="category">
              <option value="food">üçî Cibo</option>
              <option value="transport">üöó Trasporti</option>
              <option value="home">üè† Casa</option>
              <option value="shopping">üõçÔ∏è Shopping</option>
              <option value="leisure">üéâ Svago</option>
              <option value="health">üè• Salute</option>
              <option value="other">üí° Altro</option>
            </select>
          </div>
        </div>
        <div class="input-row">
          <div class="input-group">
            <label data-i18n="descLabel">Descrizione</label>
            <input type="text" id="desc" data-placeholder="descPlaceholder" />
          </div>
        </div>
        <div class="input-row">
          <div class="input-group" style="flex: 1.5">
            <label data-i18n="amountLabel">Importo</label>
            <input type="number" id="amount" placeholder="0.00" step="0.01" />
          </div>
          <div class="input-group" style="flex: 1">
            <label data-i18n="typeLabel">Tipo</label>
            <select id="type">
              <option value="expense" data-i18n="optExpense">Uscita</option>
              <option value="income" data-i18n="optIncome">Entrata</option>
            </select>
          </div>
        </div>
        <button
          class="btn-main"
          id="save-btn"
          onclick="saveTransaction()"
          data-i18n="btnAdd"
        >
          Aggiungi
        </button>
        <button
          id="cancel-btn"
          onclick="resetForm()"
          style="
            display: none;
            width: 100%;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            margin-top: 15px;
            padding: 10px;
            font-size: 13px;
            cursor: pointer;
          "
          data-i18n="btnCancel"
        >
          Annulla
        </button>
      </div>

      <div class="section-header animate-in delay-4">
        <div class="section-title" data-i18n="secHistory" style="margin: 0">
          Storico
        </div>
        <select id="filter-period" class="filter-select" onchange="updateDOM()">
          <option value="all" data-i18n="pAll">Tutto</option>
          <option value="this_month" data-i18n="pThisMonth">Questo Mese</option>
          <option value="last_month" data-i18n="pLastMonth">Mese Scorso</option>
          <option value="last_3_months" data-i18n="p3Months">
            Ultimi 3 Mesi
          </option>
          <option value="this_year" data-i18n="pThisYear">Quest'Anno</option>
        </select>
      </div>

      <div class="search-wrapper animate-in delay-4">
        <svg
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input
          type="text"
          id="search-input"
          class="search-input"
          data-placeholder="searchPlaceholder"
          oninput="updateDOM()"
        />
      </div>

      <ul id="list" class="transaction-list animate-in delay-4"></ul>

      <div class="section-label animate-in delay-4" data-i18n="secData">
        Dati e Backup
      </div>

      <div class="data-actions animate-in delay-4">
        <button class="btn-secondary" onclick="exportData()">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          <span data-i18n="btnBackup">Backup (JSON)</span>
        </button>
        <button class="btn-secondary" onclick="exportCSV()">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
            ></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10 9 9 9 8 9"></polyline>
          </svg>
          <span data-i18n="btnCsv">Excel (CSV)</span>
        </button>
        <button
          class="btn-secondary"
          onclick="document.getElementById('import-file').click()"
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="17 8 12 3 7 8"></polyline>
            <line x1="12" y1="3" x2="12" y2="15"></line>
          </svg>
          <span data-i18n="btnRestore">Ripristina</span>
        </button>
        <input
          type="file"
          id="import-file"
          style="display: none"
          accept=".json"
          onchange="importData(event)"
        />
      </div>
    </div>

    <script src="app.js"></script>

    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("sw.js")
          .then(() => console.log("PWA Service Worker registrato"));
      }
    </script>
  </body>
</html>
